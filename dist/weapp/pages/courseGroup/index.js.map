{"version":3,"file":"pages/courseGroup/index.js","sources":["webpack:///._src_pages_courseGroup_index.jsx","webpack:///./src/pages/courseGroup/index.jsx?5b51","webpack:///._src_pages_courseGroup_index.less"],"sourcesContent":["import request from '@/utils/request';\nimport { navigateTo } from '@tarojs/taro';\nimport { useState, useEffect } from 'react';\nimport EntityCard from '@/components/EntityCard';\nimport { getRouterParams } from '@/utils/routeHelper';\nimport { View, ScrollView, Image, Text } from '@tarojs/components';\nimport InfiniteScrollHolder from '@/components/InfiniteScrollHolder';\nimport './index.less';\n\nfunction CourseGroup() {\n    const [current, setCurrent] = useState(1);\n    const [loading, setLoading] = useState(false);\n    const [timeStamp, setTimeStamp] = useState('');\n    const [pageTotal, setPageTotal] = useState(0);\n    const [courseList, setCourseList] = useState(null);\n    const [activeGroupId, setActiveGroupId] = useState('');\n    const [courseTypeList, setCourseTypeList] = useState([]);\n\n    function updateTimeStamp() {\n        setTimeStamp(Date.now());\n    }\n\n    function fetchCourseTypeList() {\n        request.get({\n            url: '/api/course/typeList',\n            data: {\n                page: 1,\n                size: 4,\n            },\n        }).then(({ data }) => {\n            setCourseTypeList(data?.list);\n        });\n    }\n    \n    useEffect(() => {\n        const { typeId } = getRouterParams();\n        setActiveGroupId(typeId);\n        fetchCourseTypeList();\n        updateTimeStamp();\n    }, []);\n\n    function fetchCourseList() {\n        request.get({\n            url: '/api/course/list',\n            data: {\n                page: current,\n                size: 10,\n                typeId: activeGroupId,\n            },\n        }).then(({ data }) => {\n            setPageTotal(data?.pages);\n            setCourseList(data?.list);\n        });\n    }\n    useEffect(() => {\n        if (timeStamp) {\n            fetchCourseList();\n        }\n    }, [timeStamp]);\n    \n    function hasMore() {\n        if (courseList == null || current < pageTotal) {\n            return true;\n        }\n        return false;\n    }\n\n    function onLoadMore() {\n        if(hasMore() && !loading) {\n            setCurrent(current + 1);\n            updateTimeStamp();\n        }\n    }\n\n    return (\n        <View className=\"course-group container full-height bg-gray\">\n            <View className=\"group-list full-height font-size-14\">\n                <ScrollView scrollY>\n                    {\n                        courseTypeList?.map(({ typeId, typeName, typeThumb }) => {\n                            return (\n                                <View\n                                    key={typeId}\n                                    className={`group-item ${activeGroupId === typeId ? 'active' : 'normal'}`}\n                                    onClick={() => {\n                                        setActiveGroupId(typeId);\n                                        setCurrent(1);\n                                        setPageTotal(0);\n                                        setCourseList(null);\n                                        updateTimeStamp();\n                                    }}\n                                >\n                                    <Image\n                                        src={typeThumb}\n                                        className=\"image\"\n                                        mode=\"widthFix\"\n                                    />\n                                    <Text>{typeName}</Text>\n                                </View>\n\n                            );\n                        })\n                    }\n                </ScrollView>\n            </View>\n            <View className=\"course-list flex-1 full-height\">\n                <ScrollView\n                    scrollY\n                    className=\"scroll-view\"\n                    onScrollToLower={onLoadMore}\n                >\n                    <View className=\"font-bold m-b-10 font-size-14 align-center\">\n                        {courseTypeList?.find((item) => item.typeId === activeGroupId)?.typeName}\n                    </View>\n                    {\n                        courseList?.map((data) => {\n                            return (\n                                <EntityCard\n                                    data={data}\n                                    key={data.courseId}\n                                    onClick={() => {\n                                        navigateTo({\n                                            url: `/pages/courseDetail/index?id=${data.courseId}`,\n                                        });\n                                    }}\n                                />\n                            );\n                        })\n                    }\n                    <InfiniteScrollHolder hasMore={hasMore()}/>\n                </ScrollView>\n            </View>\n        </View>\n    );\n}\n\nexport default CourseGroup;\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/babel-loader/lib/index.js!./index.jsx\"\nvar config = {\"navigationBarTitleText\":\"爱思塔编程\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/courseGroup/index', {root:{cn:[]}}, config || {}))\n\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAIA;AAAA;AAEA;AAEA;AAAA;AAEA;AACA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAIA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAEA;AAAA;AAAA;AACA;AACA;AAGA;AAEA;;;;;;;;;;;;;ACxIA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;;;;A","sourceRoot":""}