{"version":3,"file":"pages/activities/index.js","sources":["webpack:///._src_pages_activities_index.jsx","webpack:///./src/pages/activities/index.jsx?5497","webpack:///._src_pages_activities_index.less"],"sourcesContent":["import request from '@/utils/request';\r\nimport { navigateTo } from '@tarojs/taro';\r\nimport { useState, useEffect } from 'react';\r\nimport EntityCard from '@/components/EntityCard';\r\nimport { View, Text, ScrollView } from '@tarojs/components';\r\nimport InfiniteScrollHolder from '@/components/InfiniteScrollHolder';\r\nimport './index.less';\r\n\r\nfunction isTabActive(activeTabIndex, index) {\r\n    return activeTabIndex === index ? 'active': 'normal';\r\n}\r\n\r\nexport default function Activities() {\r\n    const [list, setList] = useState(null);\r\n    const [current, setCurrent] = useState(1);\r\n    const [loading, setLoading] = useState(false);\r\n    const [pageTotal, setPageTotal] = useState(0);\r\n    const [timeStamp, setTimeStamp] = useState('');\r\n    const [activeTabIndex, setActiveTabIndex] = useState(0);\r\n    \r\n    function updateTimeStamp() {\r\n        setTimeStamp(Date.now());\r\n    }\r\n\r\n    function onLoadMore() {\r\n        if(hasMore() && !loading) {\r\n            setCurrent(current + 1);\r\n            updateTimeStamp();\r\n        }\r\n    }\r\n\r\n    function resetStatus() {\r\n        setCurrent(1);\r\n        setLoading(true);\r\n        setPageTotal(0);\r\n        setList(null);\r\n        updateTimeStamp();\r\n    }\r\n    \r\n    useEffect(fetchList, [timeStamp]);\r\n\r\n    function hasMore() {\r\n        if (list == null || current < pageTotal) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function fetchList() {\r\n        setLoading(true);\r\n        request.get({\r\n            url: `/api/${activeTabIndex === 0 ? 'activity' : 'game'}/list`,\r\n            data: {\r\n                page: current,\r\n                size: 10,\r\n            },\r\n        }).then(({ data }) => {\r\n            const { list: _list = [], pages, pageNum } = data;\r\n            setPageTotal(pages);\r\n            setList(pageNum === 1 ? _list : list.concat(_list));\r\n        }).finally(() => {\r\n            setLoading(false);\r\n        });\r\n    }\r\n\r\n    return (\r\n        <View className=\"activities font-size-14\">\r\n            <View className=\"banner\" />\r\n            <View className=\"tabs align-center m-t-20 m-b-20\">\r\n                <Text\r\n                    onClick={() => {\r\n                        setActiveTabIndex(0);\r\n                        resetStatus();\r\n                    }}\r\n                    className={`tab-item m-r-20 ${isTabActive(activeTabIndex, 0)}`}\r\n                >\r\n                    活动\r\n                </Text>\r\n                <Text\r\n                    onClick={() => {\r\n                        setActiveTabIndex(1);\r\n                        resetStatus();\r\n                    }}\r\n                    className={`tab-item ${isTabActive(activeTabIndex, 1)}`}\r\n                >\r\n                    赛事\r\n                </Text>\r\n            </View>\r\n            <View className=\"list flex-1\">\r\n                <ScrollView\r\n                    scrollY\r\n                    className=\"scroll-view\"\r\n                    onScrollToLower={onLoadMore}\r\n                >\r\n                    {\r\n                        list?.map((data) => {\r\n                            const id = data.activityId || data.gameId;\r\n                            return (\r\n                                <EntityCard\r\n                                    data={data}\r\n                                    key={id}\r\n                                    onClick={() => {\r\n                                        navigateTo({\r\n                                            url: `/pages/${activeTabIndex === 0 ? 'activity' : 'game'}Detail/index?id=${id}`,\r\n                                        });\r\n                                    }}\r\n                                />\r\n                            );\r\n                        })\r\n                    }\r\n                    <InfiniteScrollHolder hasMore={hasMore()}/>\r\n                </ScrollView>\r\n            </View>\r\n        </View>\r\n    );\r\n}\r\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/babel-loader/lib/index.js!./index.jsx\"\nvar config = {\"navigationBarTitleText\":\"爱思塔编程\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/activities/index', {root:{cn:[]}}, config || {}))\n\n\n","// extracted by mini-css-extract-plugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAAA;AAEA;AAAA;AAEA;AACA;AACA;AAAA;AAIA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAGA;AAEA;AAAA;AAAA;AACA;AACA;AAGA;;;;;;;;;;;;;ACnHA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;;;;A","sourceRoot":""}