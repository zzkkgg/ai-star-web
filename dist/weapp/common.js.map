{"version":3,"file":"common.js","sources":["webpack:///._src_components_EntityCard_index.jsx","webpack:///._src_components_EntityCard_index.less","webpack:///._src_components_InfiniteScrollHolder_index.jsx","webpack:///._src_components_InfiniteScrollHolder_index.less","webpack:///._src_utils_env.js","webpack:///._src_utils_interactHelper.js","webpack:///._src_utils_request.js","webpack:///._src_utils_routeHelper.js","webpack:///._src_utils_storageHelper.js"],"sourcesContent":["import { View, Image } from '@tarojs/components';\nimport './index.less';\n\nfunction EntityCard({ data, onClick = Function.prototype }) {\n    return (\n        <View\n            onClick={onClick}\n            className=\"entity-card font-size-14\"\n        >\n            <Image\n                mode=\"widthFix\"\n                style={{ width: '50%' }}\n                src={data.activityThumb || data.gameThumb || data.courseThumb}\n            />\n            <View className=\"flex-1 content\">\n                <View className=\"inner\">\n                    {data.activityTitle || data.gameTitle || data.courseTitle}\n                </View>\n            </View>\n        </View>\n    );\n}\n\nexport default EntityCard;\n","// extracted by mini-css-extract-plugin","import { View } from '@tarojs/components';\nimport './index.less';\n\nfunction InfiniteScrollHolder({ hasMore, className }) {\n    return (\n        <View className={`align-center color-gray font-size-12 infinite-scroll-holder${className ? ` ${className}` : ''}`}>\n            {\n                hasMore ? '加载中...' : '没有更多了'\n            }\n        </View>\n    );\n}\n\nexport default InfiniteScrollHolder;\n","// extracted by mini-css-extract-plugin","const development = {\r\n    commonUrl: 'https://aistar.topwuhan.com',\r\n};\r\n\r\nconst production = {\r\n    commonUrl: 'https://aistar.topwuhan.com',\r\n};\r\n\r\nconst envMap = {\r\n    development,\r\n    production,\r\n};\r\n\r\nconst TARO_ENV = process.env.TARO_ENV;\r\nconst NODE_ENV = process.env.NODE_ENV;\r\n\r\nconst isH5 = TARO_ENV ? TARO_ENV === 'h5' : true; // 微信环境h5\r\nconst isWx = TARO_ENV === 'weapp';\r\nconst appConfigs = envMap[NODE_ENV] || development;\r\n\r\nconst isPlainH5 = isH5 && !navigator.userAgent.toLowerCase().includes('micromessenger'); // 非微信环境h5\r\n\r\nexport default appConfigs;\r\nexport {\r\n    isH5,\r\n    isWx,\r\n    isPlainH5,\r\n}\r\n","import Taro from \"@tarojs/taro\";\r\n\r\nexport function showErrorMsg(msg, duration = 3000) {\r\n    if (msg) {\r\n        Taro.showToast({\r\n            title: msg,\r\n            duration,\r\n            icon: msg?.length > 7 ? 'none' : 'error',\r\n        });\r\n    }\r\n}\r\nexport function showSuccessMsg(msg, success = () => {}) {\r\n    Taro.showToast({\r\n        title: msg,\r\n        duration: 3000,\r\n        icon: 'success',\r\n        success,\r\n    });\r\n}\r\nexport function showLoading(msg = '加载中') {\r\n    Taro.showLoading({\r\n        title: msg,\r\n    });\r\n}\r\nexport function hideLoading() {\r\n    Taro.hideLoading();\r\n}","\r\nimport Taro from '@tarojs/taro';\r\nimport env from './env';\r\nimport { getStorage } from './storageHelper';\r\nimport { showErrorMsg, showLoading, hideLoading } from './interactHelper'; \r\n\r\nconst SLASH = '/';\r\nconst slashRE = /([^:]\\/\\/)/g;\r\nconst { commonUrl } = env;\r\n\r\nfunction clearMultSlash(str) {\r\n    let result = str;\r\n    try {\r\n        result = str.replace(slashRE, SLASH); // 去除拼接字符串时产生的多余斜线【/】\r\n    } finally {\r\n        return result;\r\n    }\r\n}\r\n\r\nfunction normalizeUrl(url) {\r\n    const fullUrl = `${commonUrl}${url.startsWith(SLASH) ? url : `${SLASH}${url}`}`;\r\n    return clearMultSlash(fullUrl);\r\n}\r\n\r\nfunction isResponseOk(code) {\r\n    return String(code) === '200';\r\n}\r\n\r\nfunction defaultCatchHandler(err) {\r\n    showErrorMsg(err?.message || '请求异常');\r\n}\r\n\r\nfunction httpRequest(options = {}, method = 'GET') {\r\n    const { url, data } = options;\r\n    const requestOptions = {\r\n        data,\r\n        method,\r\n        header: {},\r\n        timeout: 10000,\r\n        url: normalizeUrl(url),\r\n    }\r\n    const openid = getStorage('openid');\r\n    if (openid) {\r\n        requestOptions.header.openid = openid;\r\n    }\r\n    const appid = getStorage('appid');\r\n    if (appid) {\r\n        requestOptions.header.appid = appid;\r\n    }\r\n    const token = getStorage('accessToken');\r\n    if (token) {\r\n        requestOptions.header.authorization = `Bearer ${token}`;\r\n    }\r\n    requestOptions.header['Content-Type'] = 'application/json';\r\n    return Taro.request(requestOptions);\r\n}\r\n\r\nconst loadingDelay = 500; // 500ms内接口返回数据则不展示加载框\r\n\r\nfunction handleReject(reject, msg) {\r\n    reject(msg);\r\n}\r\n\r\nfunction handleException(statusCode, message, rawOptions, method, _request, resolve, reject) {\r\n    if (statusCode === 400) {\r\n        if (!rawOptions.hideError) {\r\n            showErrorMsg(message);\r\n        }\r\n        handleReject(reject, message);\r\n        return;\r\n    }\r\n    if (statusCode === 401) { // 接口授权失败，没有登录或者token过期\r\n        handleReject(reject, '未登录');\r\n        return;\r\n    }\r\n    if (!rawOptions.hideError) {\r\n        showErrorMsg('请求异常');\r\n    }\r\n    handleReject(reject, '请求异常');\r\n}\r\n\r\nfunction partialRequest(method = 'GET') {\r\n    function _request(rawOptions) {\r\n        let timer = null;\r\n        let startTime;\r\n        return new Promise((resolve, reject) => {\r\n            const { showLoadModal = true, ...options } = rawOptions;\r\n            if (showLoadModal) {\r\n                timer = setTimeout(() => {\r\n                    showLoading(showLoadModal?.title || '加载中');\r\n                }, loadingDelay);\r\n                startTime = Date.now();\r\n            }\r\n            httpRequest(options, method).then((res) => {\r\n                const { data, statusCode } = res;\r\n                const { message } = data || {};\r\n                if (statusCode === 200) {\r\n                    if (isResponseOk(data?.code)) {\r\n                        resolve(data);\r\n                        return;\r\n                    }\r\n                    showErrorMsg(message);\r\n                    reject(message);\r\n                }\r\n                console.log('statusCode error', res);\r\n                handleException(statusCode, message || data.title, rawOptions, method, _request, resolve, reject);\r\n            })\r\n            .catch((err) => {\r\n                console.log('request err', err);\r\n                reject(err);\r\n            })\r\n            .finally(() => {\r\n                if (timer) {\r\n                    if (Date.now() - startTime <= loadingDelay) {  // 接口在loadingDelay时间内完成请求，则取消显示loading\r\n                        clearTimeout(timer);\r\n                        timer = null;\r\n                    } else {\r\n                        setTimeout(hideLoading, loadingDelay);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n    return _request;\r\n}\r\n\r\nconst _get = partialRequest();\r\n\r\nconst _post = partialRequest('POST');\r\n\r\nconst _put = partialRequest('PUT');\r\n\r\nconst _delete = partialRequest('DELETE');\r\n\r\nconst request = {\r\n    get: _get,\r\n    put: _put,\r\n    post: _post,\r\n    delete: _delete,\r\n};\r\n\r\nexport default request;\r\n\r\nexport {\r\n    isResponseOk,\r\n    normalizeUrl,\r\n    defaultCatchHandler,\r\n}","\r\nimport Taro from '@tarojs/taro';\r\nimport { isWx } from './env';\r\nimport { clearUserCache, getStorage, setStorage } from './storageHelper';\r\n\r\nfunction getUrl(route, params) {\r\n    let queryArr = []\r\n    Object.entries(params).forEach(([key, value]) => {\r\n        queryArr.push(`${key}=${value}`)\r\n    });\r\n    const url = queryArr.length\r\n        ? `/pages/${route}/index?${queryArr.join('&')}`\r\n        : `/pages/${route}/index`;\r\n    return url\r\n}\r\n\r\nfunction appendInviterId(params, rawUrl) {\r\n    if (params.inviterId) {\r\n        rawUrl = `${rawUrl}?inviterId=${params.inviterId}`;\r\n    }\r\n    const { path, params: routeParams } = Taro.getCurrentInstance().router;\r\n    if (path === '/pages/packageShare/index') {\r\n        setStorage('redirectPath', `/pages/packageShare/index?packageId=${routeParams.packageId}`);\r\n    }\r\n\r\n    return rawUrl;\r\n}\r\nexport function concatRedirectUrl(navigateToUrl) {\r\n    if (!location.href.includes('redirectUrl')) {\r\n        const urlSearch = location.search;\r\n        let redirectUrl = location.hash.slice(1);\r\n        if (urlSearch) {\r\n            const filterSearch = urlSearch.slice(1).split('&').filter((s) => {\r\n                return !s.match(/(state|code)=/);\r\n            }).join('&');\r\n            if (redirectUrl && filterSearch) {\r\n                redirectUrl += `?${filterSearch}`;\r\n            }\r\n        }\r\n        if (redirectUrl && !redirectUrl.includes('/login/index')) {\r\n            return `${navigateToUrl}?redirectUrl=${encodeURIComponent(redirectUrl)}`;\r\n        }\r\n    } else {\r\n        const [_, search] = location.href.split('redirectUrl');\r\n        return `${navigateToUrl}?redirectUrl${search}`;\r\n    }\r\n    return navigateToUrl;\r\n}\r\nexport function redirectToLogin() {\r\n    const params = getRouterParams();\r\n    clearUserCache();\r\n    if (isWx) { // 微信小程序\r\n        let url = '/pages/login/index';\r\n        Taro.reLaunch({\r\n            url: appendInviterId(params, url),\r\n        });\r\n    } else {\r\n        let newUrl = `${location.origin}/#/pages${location.href.includes('maternalAndEducation') ? '/maternalAndEducation' : ''}/login/index`;\r\n        location.href = concatRedirectUrl(newUrl);\r\n    }\r\n}\r\n// 不可返回，非 tabBar 页面跳转\r\nexport function redirectTo(route, params = {}) {\r\n    const url = getUrl(route, params)\r\n    Taro.redirectTo({\r\n        url\r\n    });\r\n}\r\n\r\n// 跳转到 tabBar 页面\r\nexport function switchTab(route, params = {}) {\r\n    const url = getUrl(route, params)\r\n    Taro.switchTab({\r\n        url\r\n    });\r\n}\r\n\r\n// 可返回跳转\r\nexport function navigateTo(route, params = {}, events) {\r\n    const url = getUrl(route, params)\r\n    Taro.navigateTo({\r\n        url,\r\n        events,\r\n    });\r\n}\r\n// 跳转返回跳转 delta <= 10\r\nexport function navigateBack(delta = 1) {\r\n    Taro.navigateBack({\r\n        delta\r\n    })\r\n}\r\n\r\nexport function getRouterParams() {\r\n    return Taro.getCurrentInstance().router.params;\r\n}\r\n\r\nexport function requireLoginRedirectTo(option, isRedirectTo = false) {\r\n    const accessToken = getStorage('accessToken');\r\n    if (!accessToken) {\r\n        const params = getRouterParams();\r\n        let url = '/pages/login/index';\r\n        if (params.inviterId) {\r\n            url = `${url}?inviterId=${params.inviterId}`;\r\n        }\r\n        Taro.redirectTo({\r\n            url,\r\n        });\r\n    } else {\r\n        if (isRedirectTo) {\r\n            Taro.redirectTo(option);\r\n        } else {\r\n            Taro.navigateTo(option);\r\n        }\r\n    }\r\n}","import Taro from '@tarojs/taro';\r\nimport { isH5 } from '@/utils/env';\r\n\r\nfunction setStorage(key, data) {\r\n    let _value = data;\r\n    if (isH5) {\r\n        if (typeof data === 'object') {\r\n            _value = JSON.stringify(data);\r\n        }\r\n        localStorage.setItem(key, _value);\r\n        return;\r\n    }\r\n    Taro.setStorageSync(key, _value);\r\n}\r\nfunction batchSetStorage(data = {}) {\r\n    Object.entries(data).forEach(([key, value]) => {\r\n        setStorage(key, value);\r\n    });\r\n}\r\nfunction getStorage(key) {\r\n    const value = isH5 ? localStorage.getItem(key): Taro.getStorageSync(key);\r\n    if (typeof value === 'string' && value?.match(/^\\{[\\s\\S]+}$/)) {\r\n        return JSON.parse(value);\r\n    }\r\n    return value;\r\n}\r\nfunction removeStorage(key) {\r\n    if (isH5) {\r\n        localStorage.removeItem(key);\r\n        return;\r\n    }\r\n    return Taro.removeStorageSync(key);\r\n}\r\n\r\nfunction clearUserCache() {\r\n    ['user', 'personalAssets', 'appid', 'unionid', 'code', 'mpOpenId', 'accessToken', 'expiresAt', 'refreshToken', 'openid',\r\n    'userId', 'initialAccount', 'personalAssets', 'isAuthenticated', 'inviterId'].forEach((k) => {\r\n        removeStorage(k);\r\n    });\r\n}\r\nexport {\r\n    setStorage,\r\n    getStorage,\r\n    removeStorage,\r\n    clearUserCache,\r\n    batchSetStorage,\r\n};\r\n\r\nexport default getStorage;"],"mappings":";;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAGA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAGA;AAEA;;;;;;;;;;;ACvBA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAEA;AAIA;AAEA;;;;;;;;;;;ACbA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACzBA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5IA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AClHA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAQA;;;;A","sourceRoot":""}